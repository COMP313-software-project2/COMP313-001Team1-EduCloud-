{"ast":null,"code":"var _jsxFileName = \"/Users/youngshinmin/Desktop/software-project/app/src/components/messenger.js\";\nimport React, { Component } from 'react';\nimport '../css/app.css';\nimport classNames from 'classnames';\nimport _ from 'lodash';\nimport { OrderedMap } from 'immutable';\nimport { ObjectID } from '../helpers/objectid.js';\nimport SearchUser from './search-user';\nimport moment from 'moment';\nimport UserBar from './user-bar';\nexport default class Messenger extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      height: window.innerHeight,\n      newMessage: 'Hello there...',\n      searchUser: \"\",\n      showSearchUser: false\n    };\n    this._onResize = this._onResize.bind(this);\n    this.handleSend = this.handleSend.bind(this);\n    this.renderMessage = this.renderMessage.bind(this);\n    this.scrollMessagesToBottom = this.scrollMessagesToBottom.bind(this);\n    this._onCreateChannel = this._onCreateChannel.bind(this);\n    this.renderChannelTitle = this.renderChannelTitle.bind(this);\n  }\n\n  renderChannelTitle(channel = {}) {\n    if (!channel) {\n      return null;\n    }\n\n    const {\n      store\n    } = this.props;\n    const members = store.getMembersFromChannel(channel);\n    const names = [];\n    members.forEach(user => {\n      const name = _.get(user, 'name');\n\n      names.push(name);\n    });\n\n    let title = _.join(names, ',');\n\n    if (!title && _.get(channel, 'isNew')) {\n      title = 'New Message';\n    }\n\n    return React.createElement(\"h2\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 56\n      },\n      __self: this\n    }, title);\n  }\n\n  _onCreateChannel() {\n    const {\n      store\n    } = this.props;\n    const currentUser = store.getCurrentUser();\n\n    const currentUserId = _.get(currentUser, '_id');\n\n    const channelId = new ObjectID().toString();\n    const channel = {\n      _id: channelId,\n      title: '',\n      lastMessage: \"\",\n      members: new OrderedMap(),\n      messages: new OrderedMap(),\n      isNew: true,\n      userId: currentUserId,\n      created: new Date()\n    };\n    channel.members = channel.members.set(currentUserId, true);\n    store.onCreateNewChannel(channel);\n  }\n\n  scrollMessagesToBottom() {\n    if (this.messagesRef) {\n      this.messagesRef.scrollTop = this.messagesRef.scrollHeight;\n    }\n  }\n\n  renderMessage(message) {\n    const text = _.get(message, 'body', '');\n\n    const html = _.split(text, '\\n').map((m, key) => {\n      return React.createElement(\"p\", {\n        key: key,\n        dangerouslySetInnerHTML: {\n          __html: m\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 98\n        },\n        __self: this\n      });\n    });\n\n    return html;\n  }\n\n  handleSend() {\n    const {\n      newMessage\n    } = this.state;\n    const {\n      store\n    } = this.props; //create new message\n\n    if (_.trim(newMessage).length) {\n      const messageId = new ObjectID().toString();\n      const channel = store.getActiveChannel();\n\n      const channelId = _.get(channel, '_id', null);\n\n      const currentUser = store.getCurrentUser();\n      const message = {\n        _id: messageId,\n        channelId: channelId,\n        body: newMessage,\n        // auth: _.get(currentUser, 'name', null),\n        userId: _.get(currentUser, '_id'),\n        me: true\n      };\n      store.addMessage(messageId, message);\n      this.setState({\n        newMessage: ''\n      });\n    }\n  }\n\n  _onResize() {\n    this.setState({\n      height: window.innerHeight\n    });\n  }\n\n  componentDidUpdate() {\n    this.scrollMessagesToBottom();\n  }\n\n  componentDidMount() {\n    console.log(\"Component did mount\");\n    window.addEventListener('resize', this._onResize);\n  }\n\n  componentWillUnmount() {\n    console.log(\"Component unmount\");\n    window.removeEventListener('resize', this._onResize);\n  }\n\n  render() {\n    const {\n      store\n    } = this.props;\n    const {\n      height\n    } = this.state;\n    const style = {\n      height: height\n    };\n    const activeChannel = store.getActiveChannel();\n    const messages = store.getMessagesFromChannel(activeChannel);\n    const channels = store.getChannels();\n    const members = store.getMembersFromChannel(activeChannel);\n    return React.createElement(\"div\", {\n      style: style,\n      className: \"app-messenger\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"header\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"left\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      className: \"left-action\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186\n      },\n      __self: this\n    }, React.createElement(\"i\", {\n      className: \"icon-paperplane\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186\n      },\n      __self: this\n    })), React.createElement(\"button\", {\n      onClick: this._onCreateChannel,\n      className: \"right-action\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187\n      },\n      __self: this\n    }, React.createElement(\"i\", {\n      className: \"icon-edit-modify-streamline\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187\n      },\n      __self: this\n    })), React.createElement(\"h2\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188\n      },\n      __self: this\n    }, \"Messenger\")), React.createElement(\"div\", {\n      className: \"content\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191\n      },\n      __self: this\n    }, _.get(activeChannel, 'isNew') ? React.createElement(\"div\", {\n      className: \"toolbar\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 192\n      },\n      __self: this\n    }, React.createElement(\"label\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193\n      },\n      __self: this\n    }, \"To:\"), members.map((user, key) => {\n      return React.createElement(\"span\", {\n        onClick: () => {\n          //console.log(\"you want to remove user: \", user);\n          store.removeMemberFromChannel(activeChannel, user);\n        },\n        key: key,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 196\n        },\n        __self: this\n      }, _.get(user, 'name'));\n    }), React.createElement(\"input\", {\n      placeholder: \"Type name of person...\",\n      onChange: event => {\n        const searchUserText = _.get(event, 'target.value');\n\n        this.setState({\n          searchUser: searchUserText,\n          showSearchUser: true\n        });\n      },\n      type: \"text\",\n      value: this.state.searchUser,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205\n      },\n      __self: this\n    }), this.state.showSearchUser ? React.createElement(SearchUser, {\n      onSelect: user => {\n        this.setState({\n          showSearchUser: false,\n          searchUser: ''\n        }, () => {\n          const userId = _.get(user, '_id');\n\n          const channelId = _.get(activeChannel, '_id');\n\n          store.addUserToChannel(channelId, userId);\n        });\n      },\n      search: this.state.searchUser,\n      store: store,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217\n      },\n      __self: this\n    }) : null) : this.renderChannelTitle(activeChannel)), React.createElement(\"div\", {\n      className: \"right\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 242\n      },\n      __self: this\n    }, React.createElement(UserBar, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243\n      },\n      __self: this\n    }))), React.createElement(\"div\", {\n      className: \"main\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"sidebar-left\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"channels\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 248\n      },\n      __self: this\n    }, channels.map((channel, key) => {\n      return React.createElement(\"div\", {\n        onClick: key => {\n          store.setActiveChannelId(channel._id);\n          console.log(\"Channel Id is selected\", channel._id);\n        },\n        key: channel._id,\n        className: classNames('channel', {\n          'active': _.get(activeChannel, '_id') === _.get(channel, '_id', null)\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 252\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"user-image\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 258\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"channel-info\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 260\n        },\n        __self: this\n      }, this.renderChannelTitle(channel), React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 262\n        },\n        __self: this\n      }, channel.lastMessage)));\n    }))), React.createElement(\"div\", {\n      className: \"content\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 273\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      ref: ref => this.messagesRef = ref,\n      className: \"messages\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 274\n      },\n      __self: this\n    }, messages.map((message, index) => {\n      const user = _.get(message, 'user');\n\n      return React.createElement(\"div\", {\n        key: index,\n        className: classNames('message', {\n          'me': message.me\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 281\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"message-user-image\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 282\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        src: _.get(user, 'avatar'),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 283\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"message-body\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 285\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"message-author\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 286\n        },\n        __self: this\n      }, message.me ? 'You ' : _.get(user, 'name'), \" says:\"), React.createElement(\"div\", {\n        className: \"message-text\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 287\n        },\n        __self: this\n      }, React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 288\n        },\n        __self: this\n      }, this.renderMessage(message)))));\n    })), activeChannel && members.size > 0 ? React.createElement(\"div\", {\n      className: \"messenger-input\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 300\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"text-input\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 301\n      },\n      __self: this\n    }, React.createElement(\"textarea\", {\n      onKeyUp: event => {\n        if (event.key === 'Enter' && !event.shiftKey) {\n          this.handleSend();\n        }\n      },\n      onChange: event => {\n        //console.log(\"Text is changing: \", event.target.value);\n        this.setState({\n          newMessage: _.get(event, 'target.value')\n        });\n      },\n      value: this.state.newMessage,\n      placeholder: \"Write your message\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 302\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"actions\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 314\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      onClick: this.handleSend,\n      className: \"send\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 315\n      },\n      __self: this\n    }, \"Send\"))) : null), React.createElement(\"div\", {\n      className: \"sidebar-right\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 320\n      },\n      __self: this\n    }, members.size > 0 ? React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 322\n      },\n      __self: this\n    }, React.createElement(\"h2\", {\n      className: \"title\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 323\n      },\n      __self: this\n    }, \"Members\"), React.createElement(\"div\", {\n      className: \"members\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 324\n      },\n      __self: this\n    }, members.map((member, key) => {\n      return React.createElement(\"div\", {\n        className: \"member\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 329\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"user-image\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 330\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        src: _.get(member, 'avatar'),\n        alt: \"...\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 331\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"member-info\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 333\n        },\n        __self: this\n      }, React.createElement(\"h2\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 334\n        },\n        __self: this\n      }, member.name), React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 335\n        },\n        __self: this\n      }, \"Joined:\", moment(member.created).fromNow().toString())));\n    }))) : null)));\n  }\n\n}","map":{"version":3,"sources":["/Users/youngshinmin/Desktop/software-project/app/src/components/messenger.js"],"names":["React","Component","classNames","_","OrderedMap","ObjectID","SearchUser","moment","UserBar","Messenger","constructor","props","state","height","window","innerHeight","newMessage","searchUser","showSearchUser","_onResize","bind","handleSend","renderMessage","scrollMessagesToBottom","_onCreateChannel","renderChannelTitle","channel","store","members","getMembersFromChannel","names","forEach","user","name","get","push","title","join","currentUser","getCurrentUser","currentUserId","channelId","toString","_id","lastMessage","messages","isNew","userId","created","Date","set","onCreateNewChannel","messagesRef","scrollTop","scrollHeight","message","text","html","split","map","m","key","__html","trim","length","messageId","getActiveChannel","body","me","addMessage","setState","componentDidUpdate","componentDidMount","console","log","addEventListener","componentWillUnmount","removeEventListener","render","style","activeChannel","getMessagesFromChannel","channels","getChannels","removeMemberFromChannel","event","searchUserText","addUserToChannel","setActiveChannelId","ref","index","size","shiftKey","member","fromNow"],"mappings":"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","sourcesContent":["import React, {Component} from'react'\nimport '../css/app.css'\nimport classNames from 'classnames'\nimport _ from 'lodash'\nimport {OrderedMap} from 'immutable'\nimport {ObjectID} from '../helpers/objectid.js'\nimport SearchUser from './search-user'\nimport moment from 'moment'\nimport UserBar from './user-bar'\n\nexport default class Messenger extends Component{\n\n    constructor(props) {\n\n        super(props);\n\n        this.state={\n            height:window.innerHeight,\n            newMessage: 'Hello there...',\n            searchUser:\"\",\n            showSearchUser: false,\n         \n        }\n\n        this._onResize = this._onResize.bind(this);\n        this.handleSend = this.handleSend.bind(this);\n        this.renderMessage = this.renderMessage.bind(this);\n        this.scrollMessagesToBottom = this.scrollMessagesToBottom.bind(this);\n        this._onCreateChannel = this._onCreateChannel.bind(this);\n        this.renderChannelTitle = this.renderChannelTitle.bind(this);\n    }\n\n    renderChannelTitle(channel = {}){\n\n        if(!channel){\n            return null;\n        }\n\n        const {store} = this.props;\n\n        const members = store.getMembersFromChannel(channel);\n \n\n        const names=[];\n\n        members.forEach((user) => {\n\n            const name = _.get(user, 'name');\n            names.push(name);\n        })\n\n        let title = _.join(names, ',');\n        if(!title && _.get(channel,'isNew')){\n            title = 'New Message';\n        }\n        return <h2>{title}</h2>\n    };\n\n    _onCreateChannel(){\n        const {store} =  this.props;\n\n        const currentUser = store.getCurrentUser();\n        const currentUserId = _.get(currentUser, '_id');\n\n        const channelId = new ObjectID().toString();\n        const channel = {\n            _id: channelId,\n            title: '',\n            lastMessage: \"\",\n            members: new OrderedMap(),\n            messages: new OrderedMap(),\n            isNew: true,\n            userId: currentUserId,\n            created: new Date(),\n        };\n\n        channel.members = channel.members.set(currentUserId, true);\n\n        store.onCreateNewChannel(channel);\n\n        \n    }\n\n    scrollMessagesToBottom() {\n\n        if (this.messagesRef) {\n\n            this.messagesRef.scrollTop = this.messagesRef.scrollHeight;\n        }\n    }\n\n\n    renderMessage(message){\n\n        const text = _.get(message, 'body', '');\n        const html = _.split(text, '\\n').map((m, key) => {\n\n            return <p key={key} dangerouslySetInnerHTML={{__html: m}}/>\n           \n\n        })\n\n        return html\n    }\n\n\n    handleSend() {\n        const {newMessage} = this.state;\n        const {store} = this.props;\n\n        //create new message\n        if(_.trim(newMessage).length) {\n            const messageId =  new ObjectID().toString();\n            const channel = store.getActiveChannel();\n            const channelId =_.get(channel, '_id', null);\n            const currentUser = store.getCurrentUser();\n\n            const message = {\n                _id: messageId,\n                channelId: channelId,\n                body: newMessage,\n               // auth: _.get(currentUser, 'name', null),\n                userId: _.get(currentUser, '_id'),\n                me: true,\n            };\n\n            \n            store.addMessage(messageId, message);\n\n            this.setState({\n                newMessage: '',\n            })\n        }\n        \n    \n        \n\n    }\n    _onResize() {\n\n        this.setState({\n            height: window.innerHeight\n        });\n    }\n    componentDidUpdate() {\n\n       \n        this.scrollMessagesToBottom();\n    }\n\n    \n        componentDidMount() {\n\n            console.log(\"Component did mount\");\n            window.addEventListener('resize', this._onResize);\n       \n        }\n\n        componentWillUnmount() {\n    \n          console.log(\"Component unmount\");\n          window.removeEventListener('resize', this._onResize)\n    \n        }\n    \n    \n\nrender(){\n\n    const {store} = this.props;\n    const {height}=this.state;\n\n    const style = {\n        height: height,\n    };\n\n    const activeChannel = store.getActiveChannel();\n    const messages = store.getMessagesFromChannel(activeChannel);\n    const channels = store.getChannels();\n    const members = store.getMembersFromChannel(activeChannel);\n\n    return (\n     <div style={style} className=\"app-messenger\">\n                <div className=\"header\">\n                    <div className=\"left\">\n                        <button className=\"left-action\"><i className=\"icon-paperplane\"/></button>\n                        <button onClick={this._onCreateChannel} className=\"right-action\"><i className=\"icon-edit-modify-streamline\"/></button>\n                        <h2>Messenger</h2>\n                      \n                    </div>    \n                    <div className=\"content\">\n                    {_.get(activeChannel, 'isNew') ? <div className=\"toolbar\">\n                            <label>To:</label>\n                                {\n                                    members.map((user, key)=>{\n                                        return <span onClick={() =>{\n                                                //console.log(\"you want to remove user: \", user);\n\n                                                store.removeMemberFromChannel(activeChannel, user);\n\n                                    }}\n                                        key = {key}>{_.get(user, 'name')}</span>\n                                    })\n                                 }\n                            <input placeholder=\"Type name of person...\" onChange={(event)=>{\n                                const searchUserText = _.get(event, 'target.value');\n                            \n\n                                this.setState({\n                                    searchUser: searchUserText,\n                                    showSearchUser: true,\n                                });   \n\n                            }}\n                            type=\"text\" value={this.state.searchUser}></input>\n\n                                {this.state.showSearchUser ? <SearchUser \n                                    onSelect={(user) => {\n                                       \n                                    \n                                        this.setState({\n                                            showSearchUser: false,\n                                            searchUser:'',\n\n\n                                        }, () => {\n                                            \n                                            const userId = _.get(user, '_id');\n                                            const channelId = _.get(activeChannel, '_id');\n\n                                            store.addUserToChannel(channelId, userId);\n                                        });\n                                    }}\n\n                                     search={this.state.searchUser} store={store}/> : null \n                                     }\n                        \n                        </div> : this.renderChannelTitle(activeChannel)}\n\n                    \n                        </div>\n                    <div className=\"right\">\n                        <UserBar />\n                    </div>\n                </div>\n                <div className=\"main\">\n                        <div className=\"sidebar-left\">\n                            <div className=\"channels\">\n\n                                {channels.map((channel, key) => {\n                                    return (\n                                        <div onClick={(key) => {\n                                           \n                                                store.setActiveChannelId(channel._id);\n                                                console.log(\"Channel Id is selected\", channel._id);\n\n                                            }} key={channel._id} className={classNames('channel', {'active' : _.get(activeChannel, '_id') === _.get(channel,'_id', null) } )}>\n                                            <div className=\"user-image\">\n                                            </div>\n                                    <div className=\"channel-info\">\n                                        {this.renderChannelTitle(channel)}\n                                        <p>{channel.lastMessage}</p>\n                                    </div>\n                                </div>\n\n                                    )\n                                })}\n\n                 \n                            </div>\n\n                        </div>\n                        <div className=\"content\">\n                            <div ref={(ref) => this.messagesRef = ref} className=\"messages\">\n\n                                {messages.map((message, index) => {\n\n                                    const user = _.get(message,'user');\n\n                                return (\n                                    <div key={index} className={classNames('message', {'me': message.me})}>\n                                    <div className=\"message-user-image\">\n                                        <img src = {_.get(user, 'avatar')}></img>\n                                    </div>\n                                    <div className=\"message-body\">\n                                    <div className=\"message-author\">{message.me ? 'You ' : _.get(user, 'name')} says:</div>\n                                    <div className=\"message-text\">\n                                        <p>\n                                            {this.renderMessage(message)}\n                                        </p>\n                                    </div>\n\n                                    </div>\n                                </div>\n                                )\n                            })}\n\n                            </div>\n\n                            {activeChannel && members.size > 0 ? <div className=\"messenger-input\">\n                               <div className=\"text-input\">\n                                    <textarea onKeyUp = {(event) => {\n\n                                        if(event.key ==='Enter' && !event.shiftKey){\n                                        this.handleSend();\n                                        }\n                                    }}\n                                    onChange={(event) => {\n                                        //console.log(\"Text is changing: \", event.target.value);\n                                        this.setState({newMessage: _.get(event, 'target.value')});\n\n                                        }} value={this.state.newMessage} placeholder =\"Write your message\" />\n                                    </div>\n                                    <div className=\"actions\">\n                                        <button onClick={this.handleSend} className=\"send\">Send</button>\n                                    </div> \n                               </div> : null }\n\n                               </div>\n                        <div className=\"sidebar-right\">\n\n                            { members.size > 0 ? <div>\n                            <h2 className=\"title\">Members</h2>\n                            <div className=\"members\">\n                            {members.map((member, key) => {\n                                \n                                    return (\n                                        \n                                    <div className=\"member\">\n                                        <div className=\"user-image\">\n                                            <img src={_.get(member,'avatar')} alt=\"...\"></img>\n                                        </div>\n                                        <div className=\"member-info\">\n                                            <h2>{member.name}</h2>\n                                            <p>Joined:{moment(member.created).fromNow().toString()}</p>\n                                        </div>\n                                    </div>\n                                    )\n                                })}\n                               \n                                </div></div> :  null}\n\n                            </div>\n\n\n\n                        </div>\n                </div>\n            \n                \n        )      \n}\n}\n"]},"metadata":{},"sourceType":"module"}