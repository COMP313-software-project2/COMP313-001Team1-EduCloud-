{"ast":null,"code":"var _jsxFileName = \"/Users/youngshinmin/Desktop/software-project/app/src/components/messenger.js\";\nimport React, { Component } from 'react';\nimport '../css/app.css';\nimport classNames from 'classnames';\nimport _ from 'lodash';\nimport { OrderedMap } from 'immutable';\nimport { ObjectID } from '../helpers/objectid.js';\nimport SearchUser from './search-user';\nimport moment from 'moment';\nexport default class Messenger extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      height: window.innerHeight,\n      newMessage: 'Hello there...',\n      searchUser: \"\"\n    };\n    this._onResize = this._onResize.bind(this);\n    this.addTestMessages = this.addTestMessages.bind(this);\n    this.handleSend = this.handleSend.bind(this);\n    this.renderMessage = this.renderMessage.bind(this);\n    this.scrollMessagesToBottom = this.scrollMessagesToBottom.bind(this);\n    this._onCreateChannel = this._onCreateChannel.bind(this);\n  }\n\n  _onCreateChannel() {\n    const {\n      store\n    } = this.props; // const currentUser = store.getCurrentUser();\n    // const currentUserId = _.get(currentUser, '_id');\n\n    const channelId = new ObjectID().toString();\n    const channel = {\n      _id: channelId,\n      title: 'New Message',\n      lastMessage: \"\",\n      members: new OrderedMap(),\n      messages: new OrderedMap(),\n      isNew: true,\n      created: new Date()\n    }; //channel.members = channel.members.set(currentUserId, true);\n\n    store.onCreateNewChannel(channel);\n  }\n\n  scrollMessagesToBottom() {\n    if (this.messagesRef) {\n      this.messagesRef.scrollTop = this.messagesRef.scrollHeight;\n    }\n  }\n\n  renderMessage(message) {\n    const text = _.get(message, 'body', '');\n\n    const html = _.split(text, '\\n').map((m, key) => {\n      return React.createElement(\"p\", {\n        key: key,\n        dangerouslySetInnerHTML: {\n          __html: m\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 69\n        },\n        __self: this\n      });\n    });\n\n    return html;\n  }\n\n  handleSend() {\n    const {\n      newMessage\n    } = this.state;\n    const {\n      store\n    } = this.props; //create new message\n\n    if (_.trim(newMessage).length) {\n      const messageId = new ObjectID().toString();\n      const channel = store.getActiveChannel();\n\n      const channelId = _.get(channel, '_id', null);\n\n      const currentUser = store.getCurrentUser();\n      const message = {\n        _id: messageId,\n        channelId: channelId,\n        body: newMessage,\n        auth: _.get(currentUser, 'name', null),\n        me: true\n      };\n      store.addMessage(messageId, message);\n      this.setState({\n        newMessage: ''\n      });\n    }\n  }\n\n  _onResize() {\n    this.setState({\n      height: window.innerHeight\n    });\n  }\n\n  componentDidUpdate() {\n    this.scrollMessagesToBottom();\n  }\n\n  componentDidMount() {\n    console.log(\"Component did mount\");\n    window.addEventListener('resize', this._onResize);\n    this.addTestMessages();\n  }\n\n  addTestMessages() {\n    const {\n      store\n    } = this.props; // const store =this.props.store;\n\n    for (let i = 0; i < 100; i++) {\n      let isMe = false;\n\n      if (i % 3 === 0) {\n        isMe = true;\n      }\n\n      const newMsg = {\n        _id: `${i}`,\n        body: `The body of message ${i}`,\n        author: `Author: ${i}`,\n        me: isMe\n      };\n      console.log(typeof i);\n      store.addMessage(i, newMsg); //i need upsate my componen and re-render it now because new messages added \n    } //create some test channels\n\n\n    for (let c = 0; c < 10; c++) {\n      let newChannel = {\n        _id: `${c}`,\n        title: `Channel title ${c}`,\n        lastMessage: `Hey there here...${c}`,\n        members: new OrderedMap({\n          '2': true,\n          '3': true,\n          '1': true\n        }),\n        messages: new OrderedMap(),\n        created: new Date()\n      };\n      const msgId = `${c}`;\n      const moreMsgId = `${c + 1}`;\n      newChannel.messages = newChannel.messages.set(msgId, true);\n      newChannel.messages = newChannel.messages.set(moreMsgId, true);\n      store.addChannel(c, newChannel);\n    }\n  }\n\n  componentWillUnmount() {\n    console.log(\"Component unmount\");\n    window.removeEventListener('resize', this._onResize);\n  }\n\n  render() {\n    const {\n      store\n    } = this.props;\n    const {\n      height\n    } = this.state;\n    const style = {\n      height: height\n    };\n    const activeChannel = store.getActiveChannel();\n    const messages = store.getMessagesFromChannel(activeChannel);\n    const channels = store.getChannels();\n    const members = store.getMembersFromChannel(activeChannel);\n    return React.createElement(\"div\", {\n      style: style,\n      className: \"app-messenger\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"header\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"left\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      className: \"left-action\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202\n      },\n      __self: this\n    }, React.createElement(\"i\", {\n      className: \"icon-paperplane\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202\n      },\n      __self: this\n    })), React.createElement(\"button\", {\n      onClick: this._onCreateChannel,\n      className: \"right-action\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203\n      },\n      __self: this\n    }, React.createElement(\"i\", {\n      className: \"icon-edit-modify-streamline\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203\n      },\n      __self: this\n    })), React.createElement(\"h2\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204\n      },\n      __self: this\n    }, \"Messenger\")), React.createElement(\"div\", {\n      className: \"content\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 207\n      },\n      __self: this\n    }, _.get(activeChannel, 'isNew') ? React.createElement(\"div\", {\n      className: \"toolbar\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208\n      },\n      __self: this\n    }, React.createElement(\"label\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209\n      },\n      __self: this\n    }, \"To\"), React.createElement(\"input\", {\n      placeholder: \"Type the name of person...\",\n      onChange: event => {\n        const searchUserText = _.get(event, 'target.value');\n\n        {\n          /* console.log(\"searching for user with name: \",searchUserText)  */\n        }\n        this.setState({\n          searchUser: searchUserText\n        });\n      },\n      type: \"text\",\n      value: this.state.searchUser,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210\n      },\n      __self: this\n    }), React.createElement(SearchUser, {\n      search: this.state.searchUser,\n      store: store,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 222\n      },\n      __self: this\n    })) : React.createElement(\"h2\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 224\n      },\n      __self: this\n    }, _.get(activeChannel, 'title', ''))), React.createElement(\"div\", {\n      className: \"right\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 228\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"user-bar\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"profile-name\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230\n      },\n      __self: this\n    }, \"James Ray\"), React.createElement(\"div\", {\n      className: \"profile-image\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231\n      },\n      __self: this\n    })))), React.createElement(\"div\", {\n      className: \"main\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 235\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"sidebar-left\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"channels\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237\n      },\n      __self: this\n    }, channels.map((channel, key) => {\n      return React.createElement(\"div\", {\n        onClick: key => {\n          //this._onSelectChannel(key)\n          store.setActiveChannelId(channel._id);\n          console.log(\"Channel Id is selected\", channel._id);\n        },\n        key: channel._id,\n        className: classNames('channel', {\n          'active': _.get(activeChannel, '_id') === _.get(channel, '_id', null)\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 241\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"user-image\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 247\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"channel-info\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 249\n        },\n        __self: this\n      }, React.createElement(\"h2\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 250\n        },\n        __self: this\n      }, channel.title), React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 251\n        },\n        __self: this\n      }, channel.lastMessage)));\n    }))), React.createElement(\"div\", {\n      className: \"content\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 262\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      ref: ref => this.messagesRef = ref,\n      className: \"messages\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 263\n      },\n      __self: this\n    }, messages.map((message, index) => {\n      return React.createElement(\"div\", {\n        key: index,\n        className: classNames('message', {\n          'me': message.me\n        }),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 268\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"message-user-image\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 269\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"message-body\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 272\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"message-author\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 273\n        },\n        __self: this\n      }, message.me ? 'You ' : message.author, \" says:\"), React.createElement(\"div\", {\n        className: \"message-text\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 274\n        },\n        __self: this\n      }, React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 275\n        },\n        __self: this\n      }, this.renderMessage(message)))));\n    })), React.createElement(\"div\", {\n      className: \"messenger-input\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 286\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"text-input\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 287\n      },\n      __self: this\n    }, React.createElement(\"textarea\", {\n      onKeyUp: event => {\n        if (event.key === 'Enter' && !event.shiftKey) {\n          this.handleSend();\n        }\n      },\n      onChange: event => {\n        //console.log(\"Text is changing: \", event.target.value);\n        this.setState({\n          newMessage: _.get(event, 'target.value')\n        });\n      },\n      value: this.state.newMessage,\n      placeholder: \"Write your message\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 288\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"actions\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 300\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      onClick: this.handleSend,\n      className: \"send\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 301\n      },\n      __self: this\n    }, \"Send\")))), React.createElement(\"div\", {\n      className: \"sidebar-right\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 305\n      },\n      __self: this\n    }, members.size > 0 ? React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 307\n      },\n      __self: this\n    }, React.createElement(\"h2\", {\n      className: \"title\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 308\n      },\n      __self: this\n    }, \"Members\"), React.createElement(\"div\", {\n      className: \"members\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 309\n      },\n      __self: this\n    }, members.map((member, key) => {\n      return React.createElement(\"div\", {\n        className: \"member\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 314\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"user-image\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 315\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        src: _.get(member, 'avatar'),\n        alt: \"...\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 316\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"member-info\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 318\n        },\n        __self: this\n      }, React.createElement(\"h2\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 319\n        },\n        __self: this\n      }, member.name), React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 320\n        },\n        __self: this\n      }, \"Joined:\", moment(member.created).fromNow().toString())));\n    }))) : null)));\n  }\n\n}","map":{"version":3,"sources":["/Users/youngshinmin/Desktop/software-project/app/src/components/messenger.js"],"names":["React","Component","classNames","_","OrderedMap","ObjectID","SearchUser","moment","Messenger","constructor","props","state","height","window","innerHeight","newMessage","searchUser","_onResize","bind","addTestMessages","handleSend","renderMessage","scrollMessagesToBottom","_onCreateChannel","store","channelId","toString","channel","_id","title","lastMessage","members","messages","isNew","created","Date","onCreateNewChannel","messagesRef","scrollTop","scrollHeight","message","text","get","html","split","map","m","key","__html","trim","length","messageId","getActiveChannel","currentUser","getCurrentUser","body","auth","me","addMessage","setState","componentDidUpdate","componentDidMount","console","log","addEventListener","i","isMe","newMsg","author","c","newChannel","msgId","moreMsgId","set","addChannel","componentWillUnmount","removeEventListener","render","style","activeChannel","getMessagesFromChannel","channels","getChannels","getMembersFromChannel","event","searchUserText","setActiveChannelId","ref","index","shiftKey","size","member","name","fromNow"],"mappings":";AAAA,OAAOA,KAAP,IAAeC,SAAf,QAA8B,OAA9B;AACA,OAAO,gBAAP;AACA,OAAOC,UAAP,MAAuB,YAAvB;AACA,OAAOC,CAAP,MAAc,QAAd;AACA,SAAQC,UAAR,QAAyB,WAAzB;AACA,SAAQC,QAAR,QAAuB,wBAAvB;AACA,OAAOC,UAAP,MAAuB,eAAvB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AAEA,eAAe,MAAMC,SAAN,SAAwBP,SAAxB,CAAiC;AAE5CQ,EAAAA,WAAW,CAACC,KAAD,EAAQ;AAEf,UAAMA,KAAN;AAEA,SAAKC,KAAL,GAAW;AACPC,MAAAA,MAAM,EAACC,MAAM,CAACC,WADP;AAEPC,MAAAA,UAAU,EAAE,gBAFL;AAGPC,MAAAA,UAAU,EAAC;AAHJ,KAAX;AAOA,SAAKC,SAAL,GAAiB,KAAKA,SAAL,CAAeC,IAAf,CAAoB,IAApB,CAAjB;AACA,SAAKC,eAAL,GAAuB,KAAKA,eAAL,CAAqBD,IAArB,CAA0B,IAA1B,CAAvB;AACA,SAAKE,UAAL,GAAkB,KAAKA,UAAL,CAAgBF,IAAhB,CAAqB,IAArB,CAAlB;AACA,SAAKG,aAAL,GAAqB,KAAKA,aAAL,CAAmBH,IAAnB,CAAwB,IAAxB,CAArB;AACA,SAAKI,sBAAL,GAA8B,KAAKA,sBAAL,CAA4BJ,IAA5B,CAAiC,IAAjC,CAA9B;AACA,SAAKK,gBAAL,GAAwB,KAAKA,gBAAL,CAAsBL,IAAtB,CAA2B,IAA3B,CAAxB;AACH;;AAEDK,EAAAA,gBAAgB,GAAE;AACd,UAAM;AAACC,MAAAA;AAAD,QAAW,KAAKd,KAAtB,CADc,CAGd;AACA;;AAEA,UAAMe,SAAS,GAAG,IAAIpB,QAAJ,GAAeqB,QAAf,EAAlB;AACA,UAAMC,OAAO,GAAG;AACZC,MAAAA,GAAG,EAAEH,SADO;AAEZI,MAAAA,KAAK,EAAE,aAFK;AAGZC,MAAAA,WAAW,EAAE,EAHD;AAIZC,MAAAA,OAAO,EAAE,IAAI3B,UAAJ,EAJG;AAKZ4B,MAAAA,QAAQ,EAAE,IAAI5B,UAAJ,EALE;AAMZ6B,MAAAA,KAAK,EAAE,IANK;AAOZC,MAAAA,OAAO,EAAE,IAAIC,IAAJ;AAPG,KAAhB,CAPc,CAiBd;;AAEAX,IAAAA,KAAK,CAACY,kBAAN,CAAyBT,OAAzB;AAGH;;AAEDL,EAAAA,sBAAsB,GAAG;AAErB,QAAI,KAAKe,WAAT,EAAsB;AAElB,WAAKA,WAAL,CAAiBC,SAAjB,GAA6B,KAAKD,WAAL,CAAiBE,YAA9C;AACH;AACJ;;AAGDlB,EAAAA,aAAa,CAACmB,OAAD,EAAS;AAElB,UAAMC,IAAI,GAAGtC,CAAC,CAACuC,GAAF,CAAMF,OAAN,EAAe,MAAf,EAAuB,EAAvB,CAAb;;AACA,UAAMG,IAAI,GAAGxC,CAAC,CAACyC,KAAF,CAAQH,IAAR,EAAc,IAAd,EAAoBI,GAApB,CAAwB,CAACC,CAAD,EAAIC,GAAJ,KAAY;AAE7C,aAAO;AAAG,QAAA,GAAG,EAAEA,GAAR;AAAa,QAAA,uBAAuB,EAAE;AAACC,UAAAA,MAAM,EAAEF;AAAT,SAAtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAAP;AAGH,KALY,CAAb;;AAOA,WAAOH,IAAP;AACH;;AAGDvB,EAAAA,UAAU,GAAG;AACT,UAAM;AAACL,MAAAA;AAAD,QAAe,KAAKJ,KAA1B;AACA,UAAM;AAACa,MAAAA;AAAD,QAAU,KAAKd,KAArB,CAFS,CAIT;;AACA,QAAGP,CAAC,CAAC8C,IAAF,CAAOlC,UAAP,EAAmBmC,MAAtB,EAA8B;AAC1B,YAAMC,SAAS,GAAI,IAAI9C,QAAJ,GAAeqB,QAAf,EAAnB;AACA,YAAMC,OAAO,GAAGH,KAAK,CAAC4B,gBAAN,EAAhB;;AACA,YAAM3B,SAAS,GAAEtB,CAAC,CAACuC,GAAF,CAAMf,OAAN,EAAe,KAAf,EAAsB,IAAtB,CAAjB;;AACA,YAAM0B,WAAW,GAAG7B,KAAK,CAAC8B,cAAN,EAApB;AAEA,YAAMd,OAAO,GAAG;AACZZ,QAAAA,GAAG,EAAEuB,SADO;AAEZ1B,QAAAA,SAAS,EAAEA,SAFC;AAGZ8B,QAAAA,IAAI,EAAExC,UAHM;AAIZyC,QAAAA,IAAI,EAAErD,CAAC,CAACuC,GAAF,CAAMW,WAAN,EAAmB,MAAnB,EAA2B,IAA3B,CAJM;AAKZI,QAAAA,EAAE,EAAE;AALQ,OAAhB;AASAjC,MAAAA,KAAK,CAACkC,UAAN,CAAiBP,SAAjB,EAA4BX,OAA5B;AAEA,WAAKmB,QAAL,CAAc;AACV5C,QAAAA,UAAU,EAAE;AADF,OAAd;AAGH;AAKJ;;AACDE,EAAAA,SAAS,GAAG;AAER,SAAK0C,QAAL,CAAc;AACV/C,MAAAA,MAAM,EAAEC,MAAM,CAACC;AADL,KAAd;AAGH;;AACD8C,EAAAA,kBAAkB,GAAG;AAGjB,SAAKtC,sBAAL;AACH;;AAGGuC,EAAAA,iBAAiB,GAAG;AAEhBC,IAAAA,OAAO,CAACC,GAAR,CAAY,qBAAZ;AACAlD,IAAAA,MAAM,CAACmD,gBAAP,CAAwB,QAAxB,EAAkC,KAAK/C,SAAvC;AACA,SAAKE,eAAL;AACH;;AAEDA,EAAAA,eAAe,GAAE;AAEb,UAAM;AAACK,MAAAA;AAAD,QAAW,KAAKd,KAAtB,CAFa,CAIb;;AAEA,SAAI,IAAIuD,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG,GAAnB,EAAwBA,CAAC,EAAzB,EAA8B;AAC1B,UAAIC,IAAI,GAAG,KAAX;;AAEJ,UAAGD,CAAC,GAAG,CAAJ,KAAU,CAAb,EAAgB;AACZC,QAAAA,IAAI,GAAE,IAAN;AACH;;AACG,YAAMC,MAAM,GAAG;AACXvC,QAAAA,GAAG,EAAG,GAAEqC,CAAE,EADC;AAEXV,QAAAA,IAAI,EAAG,uBAAsBU,CAAE,EAFpB;AAGXG,QAAAA,MAAM,EAAG,WAAUH,CAAE,EAHV;AAIXR,QAAAA,EAAE,EAAES;AAJO,OAAf;AAMAJ,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAOE,CAAnB;AACAzC,MAAAA,KAAK,CAACkC,UAAN,CAAiBO,CAAjB,EAAoBE,MAApB,EAb0B,CAc1B;AACH,KArBY,CAuBN;;;AACA,SAAI,IAAIE,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG,EAAnB,EAAuBA,CAAC,EAAxB,EAA4B;AAC3B,UAAIC,UAAU,GAAG;AACb1C,QAAAA,GAAG,EAAG,GAAEyC,CAAE,EADG;AAEbxC,QAAAA,KAAK,EAAG,iBAAgBwC,CAAE,EAFb;AAGbvC,QAAAA,WAAW,EAAE,oBAAmBuC,CAAE,EAHrB;AAIbtC,QAAAA,OAAO,EAAE,IAAI3B,UAAJ,CAAe;AACpB,eAAI,IADgB;AAEpB,eAAI,IAFgB;AAGpB,eAAI;AAHgB,SAAf,CAJI;AASb4B,QAAAA,QAAQ,EAAE,IAAI5B,UAAJ,EATG;AAUb8B,QAAAA,OAAO,EAAE,IAAIC,IAAJ;AAVI,OAAjB;AAYA,YAAMoC,KAAK,GAAI,GAAEF,CAAE,EAAnB;AACA,YAAMG,SAAS,GAAI,GAAEH,CAAC,GAAG,CAAE,EAA3B;AACAC,MAAAA,UAAU,CAACtC,QAAX,GAAsBsC,UAAU,CAACtC,QAAX,CAAoByC,GAApB,CAAwBF,KAAxB,EAA+B,IAA/B,CAAtB;AACAD,MAAAA,UAAU,CAACtC,QAAX,GAAsBsC,UAAU,CAACtC,QAAX,CAAoByC,GAApB,CAAwBD,SAAxB,EAAmC,IAAnC,CAAtB;AACAhD,MAAAA,KAAK,CAACkD,UAAN,CAAiBL,CAAjB,EAAoBC,UAApB;AACH;AAER;;AAEDK,EAAAA,oBAAoB,GAAG;AAErBb,IAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ;AACAlD,IAAAA,MAAM,CAAC+D,mBAAP,CAA2B,QAA3B,EAAqC,KAAK3D,SAA1C;AAED;;AAIT4D,EAAAA,MAAM,GAAE;AAEJ,UAAM;AAACrD,MAAAA;AAAD,QAAU,KAAKd,KAArB;AACA,UAAM;AAACE,MAAAA;AAAD,QAAS,KAAKD,KAApB;AAEA,UAAMmE,KAAK,GAAG;AACVlE,MAAAA,MAAM,EAAEA;AADE,KAAd;AAIA,UAAMmE,aAAa,GAAGvD,KAAK,CAAC4B,gBAAN,EAAtB;AACA,UAAMpB,QAAQ,GAAGR,KAAK,CAACwD,sBAAN,CAA6BD,aAA7B,CAAjB;AACA,UAAME,QAAQ,GAAGzD,KAAK,CAAC0D,WAAN,EAAjB;AACA,UAAMnD,OAAO,GAAGP,KAAK,CAAC2D,qBAAN,CAA4BJ,aAA5B,CAAhB;AAEA,WACC;AAAK,MAAA,KAAK,EAAED,KAAZ;AAAmB,MAAA,SAAS,EAAC,eAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACW;AAAK,MAAA,SAAS,EAAC,QAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAK,MAAA,SAAS,EAAC,MAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAQ,MAAA,SAAS,EAAC,aAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAgC;AAAG,MAAA,SAAS,EAAC,iBAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAAhC,CADJ,EAEI;AAAQ,MAAA,OAAO,EAAE,KAAKvD,gBAAtB;AAAwC,MAAA,SAAS,EAAC,cAAlD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAiE;AAAG,MAAA,SAAS,EAAC,6BAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAAjE,CAFJ,EAGI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAHJ,CADJ,EAOI;AAAK,MAAA,SAAS,EAAC,SAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACCpB,CAAC,CAACuC,GAAF,CAAMqC,aAAN,EAAqB,OAArB,IAAgC;AAAK,MAAA,SAAS,EAAC,SAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YADyB,EAEzB;AAAO,MAAA,WAAW,EAAC,4BAAnB;AAAgD,MAAA,QAAQ,EAAGK,KAAD,IAAS;AAC/D,cAAMC,cAAc,GAAGlF,CAAC,CAACuC,GAAF,CAAM0C,KAAN,EAAa,cAAb,CAAvB;;AAEA;AAAC;AAAoE;AAErE,aAAKzB,QAAL,CAAc;AACV3C,UAAAA,UAAU,EAAEqE;AADF,SAAd;AAIH,OATD;AAUA,MAAA,IAAI,EAAC,MAVL;AAUY,MAAA,KAAK,EAAE,KAAK1E,KAAL,CAAWK,UAV9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAFyB,EAcrB,oBAAC,UAAD;AAAY,MAAA,MAAM,EAAE,KAAKL,KAAL,CAAWK,UAA/B;AAA2C,MAAA,KAAK,EAAEQ,KAAlD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAdqB,CAAhC,GAgBY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAKrB,CAAC,CAACuC,GAAF,CAAMqC,aAAN,EAAqB,OAArB,EAA8B,EAA9B,CAAL,CAjBb,CAPJ,EA4BI;AAAK,MAAA,SAAS,EAAC,OAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAK,MAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAK,MAAA,SAAS,EAAC,cAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBADJ,EAEI;AAAK,MAAA,SAAS,EAAC,eAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAFJ,CADJ,CA5BJ,CADX,EAoCW;AAAK,MAAA,SAAS,EAAC,MAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACQ;AAAK,MAAA,SAAS,EAAC,cAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAK,MAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAEKE,QAAQ,CAACpC,GAAT,CAAa,CAAClB,OAAD,EAAUoB,GAAV,KAAkB;AAC5B,aACI;AAAK,QAAA,OAAO,EAAGA,GAAD,IAAS;AACnB;AACIvB,UAAAA,KAAK,CAAC8D,kBAAN,CAAyB3D,OAAO,CAACC,GAAjC;AACAkC,UAAAA,OAAO,CAACC,GAAR,CAAY,wBAAZ,EAAsCpC,OAAO,CAACC,GAA9C;AAEH,SALL;AAKO,QAAA,GAAG,EAAED,OAAO,CAACC,GALpB;AAKyB,QAAA,SAAS,EAAE1B,UAAU,CAAC,SAAD,EAAY;AAAC,oBAAWC,CAAC,CAACuC,GAAF,CAAMqC,aAAN,EAAqB,KAArB,MAAgC5E,CAAC,CAACuC,GAAF,CAAMf,OAAN,EAAc,KAAd,EAAqB,IAArB;AAA5C,SAAZ,CAL9C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAMI;AAAK,QAAA,SAAS,EAAC,YAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QANJ,EAQJ;AAAK,QAAA,SAAS,EAAC,cAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAKA,OAAO,CAACE,KAAb,CADJ,EAEI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAIF,OAAO,CAACG,WAAZ,CAFJ,CARI,CADJ;AAgBH,KAjBA,CAFL,CADJ,CADR,EA2BQ;AAAK,MAAA,SAAS,EAAC,SAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAK,MAAA,GAAG,EAAGyD,GAAD,IAAS,KAAKlD,WAAL,GAAmBkD,GAAtC;AAA2C,MAAA,SAAS,EAAC,UAArD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAEKvD,QAAQ,CAACa,GAAT,CAAa,CAACL,OAAD,EAAUgD,KAAV,KAAoB;AAElC,aACI;AAAK,QAAA,GAAG,EAAEA,KAAV;AAAiB,QAAA,SAAS,EAAEtF,UAAU,CAAC,SAAD,EAAY;AAAC,gBAAMsC,OAAO,CAACiB;AAAf,SAAZ,CAAtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACA;AAAK,QAAA,SAAS,EAAC,oBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADA,EAIA;AAAK,QAAA,SAAS,EAAC,cAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACA;AAAK,QAAA,SAAS,EAAC,gBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAiCjB,OAAO,CAACiB,EAAR,GAAa,MAAb,GAAsBjB,OAAO,CAAC4B,MAA/D,WADA,EAEA;AAAK,QAAA,SAAS,EAAC,cAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACK,KAAK/C,aAAL,CAAmBmB,OAAnB,CADL,CADJ,CAFA,CAJA,CADJ;AAgBH,KAlBI,CAFL,CADJ,EAwBG;AAAK,MAAA,SAAS,EAAC,iBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAK,MAAA,SAAS,EAAC,YAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACK;AAAU,MAAA,OAAO,EAAK4C,KAAD,IAAW;AAE5B,YAAGA,KAAK,CAACrC,GAAN,KAAa,OAAb,IAAwB,CAACqC,KAAK,CAACK,QAAlC,EAA2C;AAC3C,eAAKrE,UAAL;AAAmB;AAClB,OAJL;AAMA,MAAA,QAAQ,EAAGgE,KAAD,IAAW;AACjB;AACA,aAAKzB,QAAL,CAAc;AAAC5C,UAAAA,UAAU,EAAEZ,CAAC,CAACuC,GAAF,CAAM0C,KAAN,EAAa,cAAb;AAAb,SAAd;AAEC,OAVL;AAUO,MAAA,KAAK,EAAE,KAAKzE,KAAL,CAAWI,UAVzB;AAUqC,MAAA,WAAW,EAAE,oBAVlD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADL,CADJ,EAcI;AAAK,MAAA,SAAS,EAAC,SAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAQ,MAAA,OAAO,EAAE,KAAKK,UAAtB;AAAkC,MAAA,SAAS,EAAC,MAA5C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cADJ,CAdJ,CAxBH,CA3BR,EAsEQ;AAAK,MAAA,SAAS,EAAC,eAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAEMW,OAAO,CAAC2D,IAAR,GAAe,CAAf,GAAmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACrB;AAAI,MAAA,SAAS,EAAC,OAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBADqB,EAErB;AAAK,MAAA,SAAS,EAAC,SAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACC3D,OAAO,CAACc,GAAR,CAAY,CAAC8C,MAAD,EAAS5C,GAAT,KAAiB;AAEtB,aAEA;AAAK,QAAA,SAAS,EAAC,QAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAK,QAAA,SAAS,EAAC,YAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAK,QAAA,GAAG,EAAE5C,CAAC,CAACuC,GAAF,CAAMiD,MAAN,EAAa,QAAb,CAAV;AAAkC,QAAA,GAAG,EAAC,KAAtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,CADJ,EAII;AAAK,QAAA,SAAS,EAAC,aAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAKA,MAAM,CAACC,IAAZ,CADJ,EAEI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAWrF,MAAM,CAACoF,MAAM,CAACzD,OAAR,CAAN,CAAuB2D,OAAvB,GAAiCnE,QAAjC,EAAX,CAFJ,CAJJ,CAFA;AAYH,KAdJ,CADD,CAFqB,CAAnB,GAmBkB,IArBxB,CAtER,CApCX,CADD;AA2IH;;AAvU+C","sourcesContent":["import React, {Component} from'react'\nimport '../css/app.css'\nimport classNames from 'classnames'\nimport _ from 'lodash'\nimport {OrderedMap} from 'immutable'\nimport {ObjectID} from '../helpers/objectid.js'\nimport SearchUser from './search-user'\nimport moment from 'moment'\n\nexport default class Messenger extends Component{\n\n    constructor(props) {\n\n        super(props);\n\n        this.state={\n            height:window.innerHeight,\n            newMessage: 'Hello there...',\n            searchUser:\"\",\n         \n        }\n\n        this._onResize = this._onResize.bind(this);\n        this.addTestMessages = this.addTestMessages.bind(this);\n        this.handleSend = this.handleSend.bind(this);\n        this.renderMessage = this.renderMessage.bind(this);\n        this.scrollMessagesToBottom = this.scrollMessagesToBottom.bind(this);\n        this._onCreateChannel = this._onCreateChannel.bind(this);\n    }\n\n    _onCreateChannel(){\n        const {store} =  this.props;\n\n        // const currentUser = store.getCurrentUser();\n        // const currentUserId = _.get(currentUser, '_id');\n\n        const channelId = new ObjectID().toString();\n        const channel = {\n            _id: channelId,\n            title: 'New Message',\n            lastMessage: \"\",\n            members: new OrderedMap(),\n            messages: new OrderedMap(),\n            isNew: true,\n            created: new Date(),\n        };\n\n        //channel.members = channel.members.set(currentUserId, true);\n\n        store.onCreateNewChannel(channel);\n\n        \n    }\n\n    scrollMessagesToBottom() {\n\n        if (this.messagesRef) {\n\n            this.messagesRef.scrollTop = this.messagesRef.scrollHeight;\n        }\n    }\n\n\n    renderMessage(message){\n\n        const text = _.get(message, 'body', '');\n        const html = _.split(text, '\\n').map((m, key) => {\n\n            return <p key={key} dangerouslySetInnerHTML={{__html: m}}/>\n           \n\n        })\n\n        return html\n    }\n\n\n    handleSend() {\n        const {newMessage} = this.state;\n        const {store} = this.props;\n\n        //create new message\n        if(_.trim(newMessage).length) {\n            const messageId =  new ObjectID().toString();\n            const channel = store.getActiveChannel();\n            const channelId =_.get(channel, '_id', null);\n            const currentUser = store.getCurrentUser();\n\n            const message = {\n                _id: messageId,\n                channelId: channelId,\n                body: newMessage,\n                auth: _.get(currentUser, 'name', null),\n                me: true,\n            };\n\n            \n            store.addMessage(messageId, message);\n\n            this.setState({\n                newMessage: '',\n            })\n        }\n        \n    \n        \n\n    }\n    _onResize() {\n\n        this.setState({\n            height: window.innerHeight\n        });\n    }\n    componentDidUpdate() {\n\n       \n        this.scrollMessagesToBottom();\n    }\n\n    \n        componentDidMount() {\n\n            console.log(\"Component did mount\");\n            window.addEventListener('resize', this._onResize);\n            this.addTestMessages();\n        }\n\n        addTestMessages(){\n           \n            const {store}  = this.props;\n\n            // const store =this.props.store;\n\n            for(let i = 0; i < 100; i ++) {\n                let isMe = false;\n\n            if(i % 3 === 0) {\n                isMe= true\n            }\n                const newMsg = {\n                    _id: `${i}`,\n                    body: `The body of message ${i}`,\n                    author: `Author: ${i}`,\n                    me: isMe\n                }\n                console.log(typeof i);\n                store.addMessage(i, newMsg);\n                //i need upsate my componen and re-render it now because new messages added \n            }\n\n                   //create some test channels\n                   for(let c = 0; c < 10; c++) {\n                    let newChannel = {\n                        _id: `${c}`,\n                        title: `Channel title ${c}`,\n                        lastMessage:`Hey there here...${c}`,\n                        members: new OrderedMap({\n                            '2':true,\n                            '3':true,\n                            '1':true,\n                        }),\n                        messages: new OrderedMap(),\n                        created: new Date(),\n                    }\n                    const msgId = `${c}`;\n                    const moreMsgId = `${c + 1}`\n                    newChannel.messages = newChannel.messages.set(msgId, true);\n                    newChannel.messages = newChannel.messages.set(moreMsgId, true);\n                    store.addChannel(c, newChannel);\n                }\n\n        }\n\n        componentWillUnmount() {\n    \n          console.log(\"Component unmount\");\n          window.removeEventListener('resize', this._onResize)\n    \n        }\n    \n    \n\nrender(){\n\n    const {store} = this.props;\n    const {height}=this.state;\n\n    const style = {\n        height: height,\n    };\n\n    const activeChannel = store.getActiveChannel();\n    const messages = store.getMessagesFromChannel(activeChannel);\n    const channels = store.getChannels();\n    const members = store.getMembersFromChannel(activeChannel);\n\n    return (\n     <div style={style} className=\"app-messenger\">\n                <div className=\"header\">\n                    <div className=\"left\">\n                        <button className=\"left-action\"><i className=\"icon-paperplane\"/></button>\n                        <button onClick={this._onCreateChannel} className=\"right-action\"><i className=\"icon-edit-modify-streamline\"/></button>\n                        <h2>Messenger</h2>\n                      \n                    </div>    \n                    <div className=\"content\">\n                    {_.get(activeChannel, 'isNew') ? <div className=\"toolbar\">\n                            <label>To</label>\n                            <input placeholder=\"Type the name of person...\" onChange={(event)=>{\n                                const searchUserText = _.get(event, 'target.value');\n                                \n                                {/* console.log(\"searching for user with name: \",searchUserText)  */}\n\n                                this.setState({\n                                    searchUser: searchUserText\n                                });   \n\n                            }}\n                            type=\"text\" value={this.state.searchUser}></input>\n\n                                <SearchUser search={this.state.searchUser} store={store}/>\n                        \n                        </div> : <h2>{_.get(activeChannel, 'title', '')}</h2>\n\n                    }\n                        </div>\n                    <div className=\"right\">\n                        <div className=\"user-bar\">\n                            <div className=\"profile-name\">James Ray</div>\n                            <div className=\"profile-image\"></div>\n                    </div>\n                    </div>\n                </div>\n                <div className=\"main\">\n                        <div className=\"sidebar-left\">\n                            <div className=\"channels\">\n\n                                {channels.map((channel, key) => {\n                                    return (\n                                        <div onClick={(key) => {\n                                            //this._onSelectChannel(key)\n                                                store.setActiveChannelId(channel._id);\n                                                console.log(\"Channel Id is selected\", channel._id);\n\n                                            }} key={channel._id} className={classNames('channel', {'active' : _.get(activeChannel, '_id') === _.get(channel,'_id', null) } )}>\n                                            <div className=\"user-image\">\n                                            </div>\n                                    <div className=\"channel-info\">\n                                        <h2>{channel.title}</h2>\n                                        <p>{channel.lastMessage}</p>\n                                    </div>\n                                </div>\n\n                                    )\n                                })}\n\n                 \n                            </div>\n\n                        </div>\n                        <div className=\"content\">\n                            <div ref={(ref) => this.messagesRef = ref} className=\"messages\">\n\n                                {messages.map((message, index) => {\n\n                                return (\n                                    <div key={index} className={classNames('message', {'me': message.me})}>\n                                    <div className=\"message-user-image\">\n                                        \n                                    </div>\n                                    <div className=\"message-body\">\n                                    <div className=\"message-author\">{message.me ? 'You ' : message.author} says:</div>\n                                    <div className=\"message-text\">\n                                        <p>\n                                            {this.renderMessage(message)}\n                                        </p>\n                                    </div>\n\n                                    </div>\n                                </div>\n                                )\n                            })}\n\n                            </div>\n                           <div className=\"messenger-input\">\n                               <div className=\"text-input\">\n                                    <textarea onKeyUp = {(event) => {\n\n                                        if(event.key ==='Enter' && !event.shiftKey){\n                                        this.handleSend();}\n                                        }\n                                        }\n                                    onChange={(event) => {\n                                        //console.log(\"Text is changing: \", event.target.value);\n                                        this.setState({newMessage: _.get(event, 'target.value')});\n\n                                        }} value={this.state.newMessage} placeholder =\"Write your message\" />\n                               </div>\n                               <div className=\"actions\">\n                                   <button onClick={this.handleSend} className=\"send\">Send</button>\n                               </div>\n                               </div>\n                               </div>\n                        <div className=\"sidebar-right\">\n\n                            { members.size > 0 ? <div>\n                            <h2 className=\"title\">Members</h2>\n                            <div className=\"members\">\n                            {members.map((member, key) => {\n                                \n                                    return (\n                                        \n                                    <div className=\"member\">\n                                        <div className=\"user-image\">\n                                            <img src={_.get(member,'avatar')} alt=\"...\"></img>\n                                        </div>\n                                        <div className=\"member-info\">\n                                            <h2>{member.name}</h2>\n                                            <p>Joined:{moment(member.created).fromNow().toString()}</p>\n                                        </div>\n                                    </div>\n                                    )\n                                })}\n                               \n                                </div></div> :  null}\n\n                            </div>\n\n\n\n                        </div>\n                </div>\n            \n                \n        )      \n}\n}\n"]},"metadata":{},"sourceType":"module"}